<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:135.0) Gecko/20100101 Firefox/135.0" version="25.0.3">
  <diagram name="Page-1" id="VJvK_CPioXWfgGsxYqFU">
    <mxGraphModel dx="1204" dy="1951" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="W2ifB2tHTsEKUJwp66l7-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-20" target="W2ifB2tHTsEKUJwp66l7-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-20" target="W2ifB2tHTsEKUJwp66l7-22">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="449.86" y="-520" />
              <mxPoint x="449.86" y="-229" />
              <mxPoint x="519.86" y="-229" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-20" value="TON Storage" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="519.86" y="-550" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-22" target="W2ifB2tHTsEKUJwp66l7-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-22" target="W2ifB2tHTsEKUJwp66l7-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-22" value="TON Payments Node" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="519.86" y="-260" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=1;entryDx=0;entryDy=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-50" target="W2ifB2tHTsEKUJwp66l7-27">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="819.8600000000001" y="-370" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-25" target="W2ifB2tHTsEKUJwp66l7-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-25" target="W2ifB2tHTsEKUJwp66l7-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-25" value="TON Tunnel Node" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="699.8600000000001" y="-400" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-27" target="W2ifB2tHTsEKUJwp66l7-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-27" value="TON Storage" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1159.8600000000001" y="-540" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-28" target="W2ifB2tHTsEKUJwp66l7-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-28" value="TON Tunnel Node" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="929.8600000000001" y="-260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-38" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Communication over ADNL tunnel&lt;/h1&gt;&lt;p&gt;1. White builds recursively encrypted message with instructions:&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 1. For Green: Create route with N price per packet to Yellow, with ID 1&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2. For Green: Create (free, low rate) route to Yellow, with ID 2&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 3. For Green: Send rest encrypted instructions+payload over route 1&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 3. For Yellow: Bind UDP port and route your ip+port + all further inbound UDP packets to Green, I will pay N price per packet. For all messages use attached (encrypted) instructions:&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 1. For Green: Create route with N price per packet to White, with ID 3 (id not collides with prev routes and Green cannot be sure that it is back route, we use 3 just for simpler example)&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2. For Green: Create (free, low rate) route to White, with ID 4&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 3. For Green: Send rest encrypted instructions+payload over route 3&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 4. For White (ourself): Accept message and parse payload&lt;/p&gt;&lt;p&gt;We build tunnel using 3 iterations. During the first one we setup routes &lt;br&gt;(as above), during second one we optimizing our back route by removing &lt;br&gt;build instructions and adding cached instructions. During third one we &lt;br&gt;optimizing our `forward` route by leaving only cached instructions, to &lt;br&gt;reduce tunnel overhead size.&lt;/p&gt;&lt;p&gt;When setup completed, we can start to use this channel for tunnelling our main packets, with payload. &lt;br&gt;&lt;/p&gt;&lt;p&gt;We append our payload with seqno and destination ip+port, it will be used to sent through out gateway over UDP (bind port on Yellow).&amp;nbsp;&lt;/p&gt;&lt;p&gt;When something received on Yellow&#39;s bind port, it wraps payload with source ip+port and seqno, and routes this message through tunnel to Geen-&amp;gt;White, using previously defined instructions.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="679.8600000000001" y="-1010" width="440" height="570" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-49" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Payments for tunnel&lt;/h1&gt;&lt;p&gt;After channel setup we can make payments for each node on the way, if required. Payments are done through free (low rate) channel, to be independent and go through full circle.&lt;/p&gt;&lt;p&gt;Payments are made to prepay N predefined packets, we should open virtual channel with each node first. When channel capacity is consumed we open new virtual channel, and repeating this while channel is active.&lt;/p&gt;&lt;p&gt;When channel capacity is consumed, receiver closes virtual channel and receives reward.&lt;/p&gt;&lt;p&gt;To participate in payment network, both parties should have connection over payment nodes linked with each other. It can be same payment node, or 2 different, but with channel established between them.&lt;/p&gt;&lt;p&gt;Payment network already have its own garlic routing, so payment chain is secure.&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="130" y="-550" width="310" height="330" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" edge="1" parent="1" source="W2ifB2tHTsEKUJwp66l7-28" target="W2ifB2tHTsEKUJwp66l7-50">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1050" y="-245" as="sourcePoint" />
            <mxPoint x="1220" y="-480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-50" value="&lt;div&gt;UDP&lt;/div&gt;&lt;div&gt;OUT&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1049.86" y="-260" width="40" height="60" as="geometry" />
        </mxCell>
        <mxCell id="W2ifB2tHTsEKUJwp66l7-53" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;TON Tunnel&lt;/h1&gt;&lt;p&gt;Is a proxy system with garlic routing technology that allows users to rent a gateway, binding an external address and port, and routing all traffic through a chain of tunnel nodes.&lt;/p&gt;&lt;div&gt;Node owners could earn coins by setting price per packet routed. Payments are handled by TON Payments network nodes.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Users could get external (white) ip address, secure network channel and even DDoS protection.&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="130" y="-1010" width="330" height="210" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
